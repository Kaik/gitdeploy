#!/bin/bash
#printenv
echo "   | Running branch handler master" | tee -a "$gitdeploy_log"

echo "   | Working tree: $gitdeploy_workingtree" | tee -a "$gitdeploy_log"
rm -rf "$gitdeploy_workingtree"/*
echo "   | Working tree cleaned" | tee -a "$gitdeploy_log"

# recive push data
echo "   | Running git!" | tee -a "$gitdeploy_log"
GIT_WORK_TREE=$gitdeploy_workingtree git checkout master -f &>> "$gitdeploy_git_log"
echo "   | Git done! - logfile: $gitdeploy_git_log" | tee -a "$gitdeploy_log"

# 
echo "   | Working tree ready! in $gitdeploy_workingtree" | tee -a "$gitdeploy_log"
# start your own deployment procedure for master below

# Zikula specyfic deployment

#compose working dir using commons compose tree
#echo "   | Running common/compose-tree! - this will take a while" | tee -a "$gitdeploy_log"
#sh $gitdeploy_home/common/compose-tree "$gitdeploy_workingtree" &>> "$gitdeploy_composer_log"
#echo "   | Common/compose-tree done! - logfile: $gitdeploy_composer_log" | tee -a "$gitdeploy_log"

# deploy using zikula deploy script warning ! this will clean deploy dir before deploying
#sh $gitdeploy_home/zikula/deploy-tree "$gitdeploy_workingtree" "$gitdeploy_deploy" | tee -a "$gitdeploy_log"

#Zikula fix files
#sh $gitdeploy_home/zikula/fix_autoload "$gitdeploy_deploy"

# end
echo "   | Branch handler master finished!" | tee -a "$gitdeploy_log"

